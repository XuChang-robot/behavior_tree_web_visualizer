# 行为树可视化系统

一个基于Web的纯前端行为树可视化工具，能够解析py_trees库生成的.dot文件，并提供美观的交互式可视化界面。

## 功能特性

- 📁 **文件解析**：支持解析py_trees库生成的.dot格式文件
- 🎨 **美观可视化**：生成节点间连线平滑优美的行为树图形
- 🖱️ **交互式布局**：支持拖拽移动节点，自动布局优化
- 🔗 **节点锚点**：每个节点上下各有一个锚点，连接线从锚点出发
- 🔍 **缩放功能**：支持鼠标滚轮缩放（倍数较小）和Ctrl+滚轮缩放（倍数较大）
- 💾 **导出功能**：支持将行为树导出为SVG/PNG格式
- 🌳 **子节点跟随**：支持子节点随父节点一起移动的选项
- 📐 **自动缩放**：初始加载时自动调整缩放，使行为树完全显示

## 使用方法

### 1. 打开应用

直接在浏览器中打开`index.html`文件即可使用，无需任何服务器环境。

### 2. 加载行为树文件

有两种方式加载.dot文件：

- **拖拽上传**：将.dot文件拖拽到页面上传区域
- **点击上传**：点击"选择文件"按钮选择本地.dot文件
- **加载示例**：点击"加载示例"按钮查看示例行为树

### 3. 交互操作

- **拖拽节点**：鼠标左键拖拽节点可移动位置
- **缩放视图**：鼠标滚轮缩放（倍数较小），Ctrl+滚轮缩放（倍数较大）
- **平移视图**：在空白处按住鼠标左键拖拽可移动视图
- **导出图片**：点击"保存SVG"或"保存PNG"按钮导出当前行为树

### 4. 显示设置

- **子节点随父节点一起移动**：勾选该选项后，拖拽父节点会带动所有子节点一起移动

## 技术栈

- **前端框架**：纯HTML/CSS/JavaScript（无后端）
- **可视化库**：D3.js v7
- **文件解析**：自定义.dot文件解析器

## 项目结构

```
bt_visualizer/
├── index.html                      # 主页面文件
├── app.js                         # 核心逻辑和可视化代码
├── behavior_tree_visualization.dot  # 示例行为树文件
└── README.md                       # 项目说明文档
```

## 核心功能实现

### 1. .dot文件解析

- 解析节点定义（名称、形状、颜色等属性）
- 解析连接关系（父子节点关系）
- 支持多种节点形状（矩形、椭圆、菱形、平行四边形等）
- 处理跨行属性值（如包含`\n`的标签）

### 2. 树布局算法

- 使用自底向上的方式计算节点位置
- 确保子节点围绕父节点中心对称分布
- 自动调整节点间距，避免重叠
- 平行四边形节点自动增加额外宽度

### 3. 交互功能

- 实现节点拖拽功能
- 支持子节点随父节点移动
- 实现缩放和平移功能
- 实现碰撞检测和自动布局

### 4. 连接线优化

- 使用贝塞尔曲线绘制平滑连接线
- 连接线颜色与子节点颜色相同
- 箭头自动对齐到锚点方向
- 实现连接线碰撞检测

## 支持的节点类型

| 形状 | 说明 | 典型用途 |
|------|------|---------|
| `box` / `rectangle` | 矩形（圆角） | Selector、Sequence等复合节点 |
| `ellipse` / `circle` | 椭圆 | 动作节点（Action） |
| `diamond` | 菱形 | 条件节点（Condition） |
| `parallelogram` | 平行四边形 | 并行节点（Parallel） |

## 浏览器兼容性

- Chrome/Edge（推荐）
- Firefox
- Safari
- 其他现代浏览器

## 本地运行

1. 克隆项目：
   ```bash
   git clone https://github.com/XuChang-robot/behavior_tree_web_visualizer.git
   ```
2. 打开`index.html`文件即可使用

无需安装任何依赖，无需启动服务器，纯前端应用！

## 贡献指南

欢迎提交Issue和Pull Request来改进项目！

## 许可证

MIT License

## 作者

Xu Chang - 457911161@qq.com

## 致谢

感谢以下开源项目的支持：
- D3.js - 数据可视化库
- py_trees - Python行为树库